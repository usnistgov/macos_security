id: os_sshd_fips_compliant
title: "Limit SSHD to FIPS Compliant Connections"
discussion: "If SSHD is enabled then it _MUST_ be configured to limit the Ciphers, HostbasedAcceptedAlgorithms, HostKeyAlgorithms, KexAlgorithms, MACs, PubkeyAcceptedAlgorithms, CASignatureAlgorithms to algorithms that are FIPS 140 validated.\n\nFIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meet federal requirements.\n\nOperating systems utilizing encryption _MUST_ use FIPS validated mechanisms for authenticating to cryptographic modules. \n\nNOTE: For more information on FIPS compliance with the version of SSHD included in the macOS, the manual page apple_ssh_and_fips has additional information.\n"
check: |
  fips_sshd_config=("Ciphers aes128-gcm@openssh.com" "HostbasedAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com" "HostKeyAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com" "KexAlgorithms ecdh-sha2-nistp256" "MACs hmac-sha2-256" "PubkeyAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com" "CASignatureAlgorithms ecdsa-sha2-nistp256")
  total=0
  for config in $fips_sshd_config; do
    total=$(expr $(/usr/sbin/sshd -T | /usr/bin/grep -i -c "$config") + $total)
  done
  echo $total
result:
  integer: 7
fix: "[source,bash]\n----\ninclude_dir=$(/usr/bin/awk '/^Include/ {print $2}' /etc/ssh/sshd_config | /usr/bin/tr -d '*')\nif [[ -z $include_dir ]]; then\n  /usr/bin/sed -i.bk \"1s/.*/Include \\/etc\\/ssh\\/sshd_config.d\\/\\*/\" /etc/ssh/sshd_config\nfi\nfips_sshd_config=(\"Ciphers aes128-gcm@openssh.com\" \"HostbasedAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com\" \"HostKeyAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com\" \"KexAlgorithms ecdh-sha2-nistp256\" \"MACs hmac-sha2-256\" \"PubkeyAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com\" \"CASignatureAlgorithms ecdsa-sha2-nistp256\")\n\nfor config in $fips_sshd_config; do\n  echo \"$config\" >> \"${include_dir}01-mscp-sshd.conf\"\ndone\nfor file in $(ls ${include_dir}); do\n  if [[ \"$file\" == \"100-macos.conf\" ]]; then\n      continue\n  fi\n  if [[ \"$file\" == \"01-mscp-sshd.conf\" ]]; then\n      break\n  fi\n  /bin/mv ${include_dir}${file} ${include_dir}20-${file}\ndone\n----   \n"
references:
  cce:
    - CCE-91010-9
  cci:
    - CCI-000087
    - CCI-000068
    - CCI-000803
    - CCI-002890
    - CCI-003123
  800-53r5:
    - AC-17(2)
    - IA-7
    - SC-13
    - SC-8(1)
  800-53r4:
    - AC-17(2)
    - IA-7
    - SC-8(1)
    - SC-13
    - MA-4(6)
  srg:
    - N/A
  disa_stig:
    - N/A
  800-171r2:
    - 3.1.13
    - 3.13.8
    - 3.13.11
  cmmc:
    - AC.L2-3.1.13
    - MP.L2-3.8.6
    - SC.L2-3.13.8
    - SC.L2-3.13.11
macOS:
  - "12.0"
tags:
  - 800-53r5_moderate
  - 800-53r5_high
  - 800-53r5_low
  - 800-53r4_low
  - 800-53r4_moderate
  - 800-53r4_high
  - 800-171
  - cnssi-1253
  - cmmc_lvl2
  - cmmc_lvl3
severity: "medium"
mobileconfig: false
mobileconfig_info:
