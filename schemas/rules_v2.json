{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$title": "MacOS Security Compliance Rule Schema",
  "$description": "Schema for MacOS Security Compliance Rules",
  "$type": "object",
  "components": {
    "schemas": {
      "ArrayOfStrings": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "AnyofStringIntegerBooleanArrayObject": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "integer"
          },
          {
            "type": "boolean"
          },
          {
            "type": "array",
            "$ref": "#/components/schemas/ArrayOfStrings"
          },
          {
            "type": "object",
            "additionalProperties": true
          }
        ]
      }
    }
  },
  "$defs": {
    "platformConfig": {
      "type": "object",
      "description": "Platform Configuration",
      "properties": {
        "severity": {
          "type": "string"
        },
        "benchmarks": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        },
        "fix": {
          "type": "string"
        }
      },
      "required": [
        "fix",
        "benchmarks",
        "severity"
      ]
    },
    "iosConfig": {
      "type": "object",
      "description": "iOS Configuration",
      "allOf": [
        {
          "$ref": "#/$defs/platformConfig"
        },
        {
          "properties": {
            "supervised": {
              "type": "boolean",
              "default": true
            }
          }
        }
      ],
      "required": [
        "fix",
        "benchmarks",
        "severity",
        "supervised"
      ]
    },
    "rule_os": {
      "anyOf": [
        {
          "properties": {
            "sequoia": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "sonoma": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "ventura": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "monterey": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "big_sur": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "ios_18": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "ios_17": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "properties": {
            "ios_16": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        }
      ],
      "additionalProperties": false
    },
    "platform": {
      "type": "object",
      "description": "Platform Configuration",
      "properties": {
        "check": {
          "description": "Check text",
          "type": "string"
        },
        "result": {
          "type": "object",
          "description": "Result of the check",
          "anyOf": [
            {
              "integer": {
                "type": "integer"
              }
            },
            {
              "string": {
                "type": "string"
              }
            },
            {
              "boolean": {
                "type": "boolean"
              }
            },
            {
              "base64": {
                "type": "string"
              }
            }
          ],
          "additionalProperties": false
        },
        "fix": {
          "description": "Fix text",
          "type": "string"
        }
      },
      "anyOf": [
        {
          "macos": {
            "type": "object",
            "anyOf": [
              {
                "sequoia": {
                  "$ref": "#/$defs/platformConfig"
                }
              },
              {
                "sonoma": {
                  "$ref": "#/$defs/platformConfig"
                }
              },
              {
                "ventura": {
                  "$ref": "#/$defs/platformConfig"
                }
              },
              {
                "monterey": {
                  "$ref": "#/$defs/platformConfig"
                }
              },
              {
                "big_sur": {
                  "$ref": "#/$defs/platformConfig"
                }
              }
            ],
            "additionalProperties": false
          }
        },
        {
          "ios": {
            "type": "object",
            "anyOf": [
              {
                "ios_18": {
                  "$ref": "#/$defs/iosConfig"
                }
              },
              {
                "ios_17": {
                  "$ref": "#/$defs/iosConfig"
                }
              },
              {
                "ios_16": {
                  "$ref": "#/$defs/iosConfig"
                }
              }
            ],
            "additionalProperties": false
          }
        }
      ],
      "required": [
        "check",
        "result",
        "fix"
      ]
    },
    "nistReferences": {
      "type": "object",
      "properties": {
        "cce": {
          "type": "object",
          "$ref": "#/$defs/rule_os",
          "additionalProperties": false
        },
        "800-53r5": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        },
        "800-171r3": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        }
      },
      "additionalProperties": false
    },
    "disaReferences": {
      "type": "object",
      "properties": {
        "cci": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        },
        "srg": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        },
        "stig": {
          "type": "object",
          "$ref": "#/$defs/rule_os",
          "additionalProperties": false
        },
        "cmmc": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        },
        "srf": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        }
      },
      "additionalProperties": false
    },
    "cisReferences": {
      "type": "object",
      "properties": {
        "benchmark": {
          "type": "object",
          "$ref": "#/$defs/rule_os",
          "additionalProperties": false
        },
        "controls_v8": {
          "$ref": "#/components/schemas/ArrayOfStrings"
        }
      },
      "additionalProperties": false
    },
    "references": {
      "type": "object",
      "properties": {
        "nist": {
          "$ref": "#/$defs/nistReferences"
        }
      },
      "anyOf": [
        {
          "disa": {
            "$ref": "#/$defs/disaReferences"
          }
        },
        {
          "cis": {
            "$ref": "#/$defs/cisReferences"
          }
        },
        {
          "bis": {
            "indigo": {
              "$ref": "#/components/schemas/ArrayOfStrings"
            }
          }
        },
        {
          "custom": {
            "$ref": "#/components/schemas/ArrayOfStrings"
          }
        }
      ],
      "additionalProperties": false
    }
  },
  "properties": {
    "id": {
      "type": "string"
    },
    "title": {
      "type": "string"
    },
    "discussion": {
      "type": "string"
    },
    "references": {
      "$ref": "#/$defs/references"
    },
    "platforms": {
      "type": "object",
      "anyOf": [
        {
          "macos": {
            "$ref": "#/$defs/platform"
          }
        },
        {
          "ios": {
            "$ref": "#/$defs/platform"
          }
        },
        {
          "visionos": {
            "$ref": "#/$defs/platform"
          }
        }
      ],
      "additionalProperties": false
    },
    "ddm_info": {
      "type": "object",
      "properties": {
        "declaration_type": {
          "type": "string"
        },
        "service": {
          "type": "string",
          "enum": [
            "com.apple.sshd",
            "com.apple.sudo",
            "com.apple.pam",
            "com.apple.cups",
            "com.apple.apache.httpd",
            "com.apple.bash",
            "com.apple.zsh"
          ]
        },
        "config_file": {
          "type": "string"
        },
        "configuration_value": {
          "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
        },
        "ddm_key": {
          "type": "string"
        },
        "ddm_value": {
          "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
        }
      },
      "required": [
        "declaration_type",
        "service",
        "config_file",
        "configuration_value",
        "ddm_key",
        "ddm_value"
      ]
    },
    "customized": {
      "type": "boolean"
    },
    "mobileconfig": {
      "type": "boolean"
    },
    "mobileconfig_profile": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "profileType": {
            "type": "string"
          },
          "PayloadContent": {
            "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
          }
        }
      }
    },
    "odv": {
      "type": "object",
      "properties": {
        "hint": {
          "type": "string"
        },
        "recommendation": {
          "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
        },
        "additionalProperties": true
      },
      "required": [
        "hint",
        "recommendation"
      ]
    },
    "tags": {
      "$ref": "#/components/schemas/ArrayOfStrings"
    }
  },
  "anyOf": [
    {
      "not": {
        "properties": {
          "tags": {
            "pattern": "\\b(permanent|supplemental|inherent|not_applicable)\\b"
          }
        },
        "then": {
          "properties": {
            "platforms": {
              "anyOf": [
                {
                  "macos": {
                    "required": [
                      "result"
                    ]
                  }
                },
                {
                  "ios": {
                    "required": [
                      "result"
                    ]
                  }
                },
                {
                  "visionos": {
                    "required": [
                      "result"
                    ]
                  }
                }
              ]
            }
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "mobileconfig": {
            "const": true
          }
        },
        "then": {
          "required": [
            "mobileconfig_info"
          ]
        }
      }
    }
  ],
  "required": [
    "id",
    "title",
    "discussion",
    "references",
    "platforms",
    "tags"
  ]
}
